<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>

<!-- Mirrored from 78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS/PodkljuchenieUdalennojjMery/print by HTTrack Website Copier/3.x [XR&CO'2006], Wed, 25 Jul 2012 16:14:35 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=windows-1251"><!-- /Added by HTTrack -->
<head>
  <title>IpstudioWiki : ДокументацияIPStudioAMBS/УстановкаНастройкаIPStudioAMBS/ПодключениеУдаленнойМеры</title>
<meta name="robots" content="noindex, nofollow" />
  <meta http-equiv="content-type" content="text/html; charset=windows-1251" />
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <link rel="stylesheet" type="text/css" href="http://78.46.73.113/wiki/themes/default/css/wakkaprint.css" />
</head>

<body>

<div class="header">
  IpstudioWiki : <a href="http://78.46.73.113/wiki/wakka.php?wakka=TextSearch?phrase=%C4%EE%EA%F3%EC%E5%ED%F2%E0%F6%E8%FFIPStudioAMBS%2F%D3%F1%F2%E0%ED%EE%E2%EA%E0%CD%E0%F1%F2%F0%EE%E9%EA%E0IPStudioAMBS%2F%CF%EE%E4%EA%EB%FE%F7%E5%ED%E8%E5%D3%E4%E0%EB%E5%ED%ED%EE%E9%CC%E5%F0%FB">ДокументацияIPStudioAMBS/УстановкаНастройкаIPStudioAMBS/ПодключениеУдаленнойМеры</a> 
</div>

<div class="pageBefore"><img src="http://78.46.73.113/wiki/images/z.gif" width="1" height="1" border="0" alt="" style="display:block" align="top" /></div><div class="page">
<!--notypo--><a name="PageTopLink" href="#PageTopLink" title=""></a>
<!--/notypo--><a name="h27-1"></a><h1>Установка и&nbsp;настройка IP&nbsp;Studio AMBS</h1>
<br />
<strong> <a name=".dokumentacijaipstudioambs" href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS&amp;v=oq3" class="" title="Документация&nbsp;IP&nbsp;Studio&nbsp;AMBS">В оглавление</a> </strong><br />
<ul><li> <a name="...ustanovkanastrojjkaipstudioambs" href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS&amp;v=jxa#Техническиетребования" class="" title="ДокументацияIPStudioAMBS/Установка&nbsp;Настройка&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/">Технические требования</a>
</li><li> <a  href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS&amp;v=jxa#УстановкаIPStudioAMBS" class="" title="ДокументацияIPStudioAMBS/Установка&nbsp;Настройка&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/">Установка IP&nbsp;Studio AMBS</a>
</li><li> <a  href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS&amp;v=jxa#ЧтонужнодляустановкиIPStudioAMBS" class="" title="ДокументацияIPStudioAMBS/Установка&nbsp;Настройка&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/">Информация для&nbsp;установки IP&nbsp;Studio AMBS</a>
</li><li> <strong><a  href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS/UstanovkaBinarnogoDistributiva&amp;v=143h" class="" title="ДокументацияIPStudioAMBS/Установка&nbsp;Настройка&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Установка&nbsp;Бинарного&nbsp;Дистрибутива">Инструкция по&nbsp;установке системы с&nbsp;использованием бинарного дистрибутива</a></strong>
</li><li> <strong><a href="#ПодключениеУдаленнойМеры" name="oПодключениеУдаленнойМеры">Подключение MVTS-сервера</a></strong>
</li><li> <a  href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS/RezhimyIspol'zovanijaAMBS&amp;v=1as5" class="" title="ДокументацияIPStudioAMBS/Установка&nbsp;Настройка&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Режимы&nbsp;Использования&nbsp;AMBS">Режимы использования IP&nbsp;Studio AMBS</a>
<ul><li> <a  href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS/RezhimyIspol'zovanijaAMBS&amp;v=1as5#РежимПарсинга" class="" title="ДокументацияIPStudioAMBS/Установка&nbsp;Настройка&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Режимы&nbsp;Использования&nbsp;AMBS&nbsp;/">Режим Парсинга</a>
</li><li> <a  href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS/RezhimyIspol'zovanijaAMBS&amp;v=1as5#РежимАккаунтинга" class="" title="ДокументацияIPStudioAMBS/Установка&nbsp;Настройка&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Режимы&nbsp;Использования&nbsp;AMBS&nbsp;/">Режим Аккаунтинга</a>
</li><li> <a  href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS/RezhimyIspol'zovanijaAMBS&amp;v=1as5#РежимМаршрутизации" class="" title="ДокументацияIPStudioAMBS/Установка&nbsp;Настройка&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Режимы&nbsp;Использования&nbsp;AMBS&nbsp;/">Режим Маршрутизации</a>
</li></ul></li><li> <a name="...ustanovkanastrojjkaipstudioambs.proverkaprocessovambs" href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS/ProverkaProcessovAMBS&amp;v=1asm" class="" title="ДокументацияIPStudioAMBS/Установка&nbsp;Настройка&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Проверка&nbsp;Процессов&nbsp;AMBS">Проверка работы процессов IP&nbsp;Studio AMBS</a></li></ul>
<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo--><br />
<!--notypo--><a name="ПодключениеУдаленнойМеры" href="#ПодключениеУдаленнойМеры" title=""></a>
<!--/notypo--><a name="h27-2"></a><h2> Подключение MVTS-сервера </h2>
<br />
В&nbsp;систему можно подключить неограниченное количество MVTS-серверов как&nbsp;локальных так&nbsp;и&nbsp;удаленных. <br />
<br />
Для&nbsp;подключения <u>локального MVTS-севера</u> достаточно добавить его&nbsp;в&nbsp;<u><a name="...razdelequipments.formamvtsservers" href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/RazdelEquipments/FormaMvtsServers&amp;v=219" class="" title="ДокументацияIPStudioAMBS/Раздел&nbsp;Equipments&nbsp;/&nbsp;Форма&nbsp;Mvts&nbsp;Servers">форме “MVTS Servers”</a></u> (см. пример в&nbsp;разделе &#147;Equipments&#148;).<br />
<br />
Для&nbsp;подключения <u>удаленного MVTS-сервера</u>(расположенный на&nbsp;другом сервере), предварительно необходимо проделать следующие шаги:<br />
<br />
1. На&nbsp;сервере, где&nbsp;установлен MVTS из-под пользователя “root” выполнить команду:<br />
<br />
<div class="indent">ssh-keygen -t rsa</div>
<br />
на&nbsp;все запросы нажимайть “Enter” .<br />
<br />
2. Проверить на&nbsp;AMBS-сервере наличие файла &laquo;/usr/local/billing/.ssh/authorized_keys&raquo;:<br />
<br />
<div class="indent">ls -l /usr/local/billing/.ssh/authorized_keys </div>
<br />
&ndash; если файл существует, добавьте в&nbsp;конец запись из&nbsp;файла " /root/.ssh/id_rsa.pub " MVTS-сервера<br />
 <br />
Будьте внимательны при&nbsp;редактировании файла &#147;authorized_keys&#148;, ключ не&nbsp;должен содержать символов &laquo;новой строки&raquo;, весь ключ представляет из&nbsp;себя одну строку. <br />
Пример:   <em>ssh-rsa AAAAB3NzaC1yc2EAAAABIwAC5lGw4oh/NfuV1nfAYvT/O+SQYZUS5CBiHTxM= root@mvts.xx</em><br />
<br />
&ndash; если на&nbsp;AMBS-сервере файл " /usr/local/billing/.ssh/authorized_keys " отсутствует, его&nbsp;нужно добавить.  <br />
На&nbsp;АМБС-сервере выполните команды:<br />
<div class="indent"><!--notypo--> su - ipstudio <!--/notypo--><br />
<!--notypo--> ssh ipstudio@<!--/notypo--><u><em>Адрес_Сервера_Меры</em></u> <br />
<!--notypo--> scp /root/.ssh/id_rsa.pub ipstudio@<!--/notypo--><u><em>IP_Studio_AMSB_адрес</em></u><!--notypo-->:.ssh/authorized_keys <!--/notypo--></div>
<br />
<div class="action"><div class="action-content"><table class="dtable" border="0">
<tr class="userrow"><td class="usercell"><strong>Замечание:</strong></td><td  class="usercell"> Не&nbsp;нужно создавать папку &laquo;.ssh/&raquo; вручную (командой &#147;mkdir&#148;), папка будет создана с&nbsp;другими правами, и&nbsp;ключи будут читаться неправильно.</td></tr>
</table></div></div> <br />
3. На&nbsp;MVTS-сервере, выполните команды:<br />
<br />
<div class="indent">mkdir /usr/local/billing<br />
cd&nbsp;/usr/local/billing</div>
<br />
Если такая директория отсутствует, выполните следующие команды:<br />
<br />
<div class="indent">useradd -d /usr/local/billing -m -s /bin/bash ipstudio<br />
passwd ipstudio <u><em>&lt;задайте пароль для&nbsp;пользователя ipstudio&gt;</em></u><br />
mkdir /usr/local/billing/bin<br />
mkdir /usr/local/billing/lib<br />
mkdir /usr/local/billing/lib/5.8.0<br />
mkdir /usr/local/billing/ftp<br />
mkdir /usr/local/billing/ftp/PROCEED<br />
mkdir /usr/local/billing/var<br />
mkdir /usr/local/billing/logs<br />
mkdir /usr/local/billing/etc<br />
ln&nbsp;-s /usr/local/billing/lib /usr/local/billing/bin/lib<br />
echo 20000000000000 &gt; /usr/local/billing/lastupdated<br />
<!--notypo-->scp ipstudio@<!--/notypo--><u><em>IP_Studio_AMSB_адрес</em></u><!--notypo-->:/usr/local/billing/etc/bill_util.cfg /usr/local/billing/etc/bill_util.cfg<!--/notypo--></div>
<br />
где&nbsp;<br />
<div class="indent"><em>IP_Studio_AMSB_адрес</em> &ndash; адрес сервера, где&nbsp;установлена система IP&nbsp;Studio AMBS.</div>
<br />
4.  Отредактируйте файл “bill_util.cfg”. <br />
<br />
<div class="indent">vi /usr/local/billing/etc/bill_util.cfg</div>
<br />
Поправьте следующие строки:<br />
<br />
<div class="indent">BILLING=no<br />
OWNER=ipstudio<br />
<!--notypo-->CONN_STR=ipstudio@<!--/notypo--><u><em>IP_Studio_AMSB_адрес</em></u><br />
MY_IP=<u><em>MVTS_сервер_адрес</em></u></div>
<br />
В&nbsp;этом же&nbsp;файле проверьте правильность путей к&nbsp;папкам MVTS-сервера и&nbsp;CDR-файлов:<br />
<br />
<div class="indent">MVTS=/mvts<br />
CDRDIR=/mvts/billing/<br />
</div>
где&nbsp;<br />
<div class="indent"><em>IP_Studio_AMSB_адрес</em> &ndash; замените на&nbsp;адрес сервера с&nbsp;IP Studio AMBS<br />
<em>MVTS_сервер_адрес</em> &ndash; замените на&nbsp;адрес сервера с&nbsp;MVTS.</div>
<br />
5. Выполните команды:<br />
<br />
<div class="indent">cd /usr/local/billing/var<br />
<!--notypo-->scp ipstudio@<!--/notypo--><u><em>IP_Studio_AMSB_адрес</em></u><!--notypo-->:/usr/local/billing/var/* ./<!--/notypo--><br />
cd&nbsp;/usr/local/billing<br />
<!--notypo-->scp ipstudio@<!--/notypo--><u><em>IP_Studio_AMSB_адрес</em></u><!--notypo-->:/usr/local/billing/update.pl ./<!--/notypo--><br />
chown -R ipstudio /usr/local/billing</div>
<br />
где&nbsp;<br />
<div class="indent"><em>IP_Studio_AMSB_адрес</em> &ndash; ip-адрес сервера с&nbsp;IP Studio AMBS.</div>
<br />
6. На&nbsp;сервере с&nbsp;MVTS отредактируйте файл “ld.so.conf” : <br />
<br />
<div class="indent">vi /etc/ld.so.conf</div>
<br />
Добавьте следующие строки:<br />
<br />
<div class="indent">/usr/local/billing/lib/5.8.0<br />
/usr/local/billing/mysql/lib/mysql</div>
<br />
7. После этого выполните команду:<br />
<br />
<div class="indent">ldconfig</div>
<br />
8. На&nbsp;сервере с&nbsp;MVTS отредактируйте файл “/etc/sysconfig/i18n”.<br />
<br />
<div class="indent">vi /etc/sysconfig/i18n</div>
<br />
Вам&nbsp;нужно закомментировать все&nbsp;строки (поставьте в&nbsp;начале строки символ #). <br />
<br />
9. После этого выполните команды:<br />
<br />
<div class="indent">/etc/init.d/keytable restart </div>
<br />
(keytable – может отсутствовать в&nbsp;некоторых версия ОС, это&nbsp;не&nbsp;критично)<br />
<br />
<div class="indent">export LC_ALL=C</div>
<br />
10. Запустите процесс обновления:<br />
<br />
<div class="indent">./update.pl</div>
<br />
Дождитесь окончания обновления и&nbsp;проверьте работоспособность системы. Проверьте, что&nbsp;демон системы “bill_sig_svr.pl” запущен, выполнив команду:<br />
<br />
<div class="indent">ps ax&nbsp;| grep pl</div>
<br />
Если он&nbsp;не запущен, запустите его&nbsp;вручную, выполнив команду:<br />
<br />
<div class="indent">/usr/local/billing/bin/bill_sig_svr.pl</div>
<br />
11. Добавьте команду на&nbsp;автоматический запуск скрипта системы (bill_sig_svr.pl) при&nbsp;запуске сервера. Для&nbsp;этого нужно открыть файл автозапуска:<br />
<br />
<div class="indent">vi /etc/rc.local </div>
<br />
и&nbsp;добавить в&nbsp;него следующую строку:<br />
<br />
<div class="indent">/usr/local/billing/bin/bill_sig_svr.pl </div>
<br />
сохранить изменения и&nbsp;выйти. <br />
<br />
12. На&nbsp;сервере с&nbsp;MVTS  добавьте пару строк в&nbsp;планировщик сервера (обычно это&nbsp;“/etc/crontab”) для&nbsp;того, чтобы система регулярно делала резервные копии старых логов и&nbsp;подгружала новые логи MVTS-сервера. Откройте планировщик командой:<br />
<br />
<div class="indent">vi /etc/crontab</div>
<br />
добавьте следующие строки:<br />
<br />
<div class="indent">25 0 * * * root /usr/local/billing/bin/back.sh &gt;&gt; /usr/local/billing/logs/backup.err 2&gt;&1<br />
10 * * * * root /usr/local/billing/bin/load_cdr.pl &gt;&gt; /usr/local/billing/logs/loader.err 2&gt;&1</div>
<br />
Сохраните результат и&nbsp;выйдите из&nbsp;файла.<br />
<br />
После создания модуля АМБС на&nbsp;сервере MVTS нужно добавить запись об&nbsp;этом сервере в&nbsp;<u><a  href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/RazdelEquipments/FormaMvtsServers&amp;v=219" class="" title="ДокументацияIPStudioAMBS/Раздел&nbsp;Equipments&nbsp;/&nbsp;Форма&nbsp;Mvts&nbsp;Servers">форме “MVTS Servers”</a></u> и&nbsp;связать пользователей <u><a name="...razdelequipments.formamvtsservers.instrukcijasftp" href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/RazdelEquipments/FormaMvtsServers/InstrukcijaSftp&amp;v=lyc" class="" title="ДокументацияIPStudioAMBS/Раздел&nbsp;Equipments&nbsp;/&nbsp;Форма&nbsp;Mvts&nbsp;Servers&nbsp;/&nbsp;Инструкция&nbsp;Sftp">&#147;ipstudio-ipstudio&#148; ssh-ключами</a></u>.<br />
<br />
<br />
<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo--><br />
<div class="action"><div class="action-content"><table class="dtable" border="0">
<tr class="userrow"><td class="usercell"><strong><a name="...ustanovkanastrojjkaipstudioambs.ustanovkabinarnogodistributiva" href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS/UstanovkaBinarnogoDistributiva&amp;v=143h" class="" title="ДокументацияIPStudioAMBS/Установка&nbsp;Настройка&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Установка&nbsp;Бинарного&nbsp;Дистрибутива">&lt;&lt; Назад</a></strong></td><td class="usercell"> <strong><a href="#PageTopLink" name="oPageTopLink">< Наверх ></a></strong></td><td  class="usercell"><strong><a name="...ustanovkanastrojjkaipstudioambs.rezhimyispol_zovanijaambs" href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS/RezhimyIspol'zovanijaAMBS&amp;v=1as5" class="" title="ДокументацияIPStudioAMBS/Установка&nbsp;Настройка&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Режимы&nbsp;Использования&nbsp;AMBS">Вперед &gt;&gt;</a></strong></td></tr>
</table></div></div> <br /></div>
</body>
<!-- Mirrored from 78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS/PodkljuchenieUdalennojjMery/print by HTTrack Website Copier/3.x [XR&CO'2006], Wed, 25 Jul 2012 16:14:35 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=windows-1251"><!-- /Added by HTTrack -->
</html>