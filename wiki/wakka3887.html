<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>

<!-- Mirrored from 78.46.73.113/wiki/wakka.php?wakka=AmbsCardsManual/CardsRadiusStart/print by HTTrack Website Copier/3.x [XR&CO'2006], Wed, 25 Jul 2012 16:15:38 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=windows-1251"><!-- /Added by HTTrack -->
<head>
  <title>IpstudioWiki : AmbsCardsManual/CardsRadiusStart</title>
<meta name="robots" content="noindex, nofollow" />
  <meta http-equiv="content-type" content="text/html; charset=windows-1251" />
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <link rel="stylesheet" type="text/css" href="http://78.46.73.113/wiki/themes/default/css/wakkaprint.css" />
</head>

<body>

<div class="header">
  IpstudioWiki : <a href="http://78.46.73.113/wiki/wakka.php?wakka=TextSearch?phrase=AmbsCardsManual%2FCardsRadiusStart">AmbsCardsManual/CardsRadiusStart</a> 
</div>

<div class="pageBefore"><img src="http://78.46.73.113/wiki/images/z.gif" width="1" height="1" border="0" alt="" style="display:block" align="top" /></div><div class="page">
<!--notypo--><a name="PageTopLink" href="#PageTopLink" title=""></a>
<!--/notypo--><a name="h201-1"></a><h1>Карточный модуль IP&nbsp;Studio AMBS</h1>
<br />
<strong> <a name=".ambscardsmanual" href="http://78.46.73.113/wiki/wakka.php?wakka=AmbsCardsManual&amp;v=orj" class="" title="Ambs&nbsp;Cards&nbsp;Manual">В оглавление</a> </strong><br />
<ul><li> <a name="cardsreview" href="http://78.46.73.113/wiki/wakka.php?wakka=AmbsCardsManual/CardsReview&amp;v=1571" class="" title="AmbsCardsManual/Cards&nbsp;Review">Введение в&nbsp;карточный модуль</a>
</li><li> <a name="cardsconnscheme" href="http://78.46.73.113/wiki/wakka.php?wakka=AmbsCardsManual/CardsConnScheme&amp;v=joc" class="" title="AmbsCardsManual/Cards&nbsp;Conn&nbsp;Scheme">Схема взаимодействия системы IP&nbsp;Studio AMBS с&nbsp;карточной платформой</a>
</li><li> <a  href="http://78.46.73.113/wiki/wakka.php?wakka=AmbsCardsManual/CardsPlatformOrg&amp;v=12so" class="" title="AmbsCardsManual/Cards&nbsp;Platform&nbsp;Org">Организация работы карточной платформы</a>
</li><li> <a href="#CardsRadiusStart" name="oCardsRadiusStart">Запуск карточного радиус-процесса</a>
</li><li> <a  href="http://78.46.73.113/wiki/wakka.php?wakka=AmbsCardsManual/CardsAMBSSettings&amp;v=m6n" class="" title="AmbsCardsManual/Cards&nbsp;AMBS&nbsp;Settings">Настройка карточной платформы в&nbsp;системе IP&nbsp;Studio AMBS</a></li></ul>
<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo--><br />
<!--notypo--><a name="CardsRadiusStart" href="#CardsRadiusStart" title=""></a>
<!--/notypo--><a name="h201-2"></a><h2>Запуск карточного радиус-процесса</h2>
<br />
Для&nbsp;того чтобы запустить дополнительно радиус-процесс для&nbsp;карточной платформы, следует выполнить следующие два&nbsp;действия:<br />
1. Создать файл конфигурации карточного модуля “card.cfg”.<br />
Зайдите в&nbsp;папку с&nbsp;настройками радиус процесса:<br />
<div class="indent">cd /usr/local/billing/radius/</div>
<br />
создайте файл “card.cfg”, например выполнив следующую команду:<br />
<div class="indent">vi card.cfg</div>
<br />
после этого, внесите в&nbsp;этот файл следующие данные:<br />
<!--notypo--><textarea class="code" rows="26" readonly="readonly">LogDir /usr/local/billing/radius/
DbDir /usr/local/billing/radius/
# User a lower trace level in production systems:
Trace 2
AuthPort 1912
AcctPort 1913
# You will probably want to change this to suit your site.
&lt;Client DEFAULT&gt;
Secret voipcard
DupInterval 0
&lt;/Client&gt;
&lt;Realm DEFAULT&gt;
&lt;AuthBy CARD&gt;
DBSource dbi:mysql:database=voip;host=ххх.ххх.ххх.ххх;port=3306
DBUsername voip
DBAuth djbg123
CP_LOG_FILE %Lcardlog%y%m%d.%H
ACC_LOG_FILE %Lcdr%y%m%d.%H
LOCK_FILE %Lradius.lock
CREDIT_TIME 1800
FREE_TIME 60
MAX_SEANS 16
CREDIT_SEANS 16
&lt;/AuthBy&gt;
&lt;/Realm&gt;</textarea><!--/notypo--><br />
В&nbsp;этих данных вам&nbsp;нужно изменить следующие данные на&nbsp;ваши реальные:<br />
<br />
a. Адрес вашего хоста, на&nbsp;котором стоит база системы IP&nbsp;Studio AMBS в&nbsp;строке:<br />
<div class="indent"><!--notypo-->DBSource dbi:mysql:database=voip;host=ХХХ.ХХХ.ХХХ.ХХХ;port=3306<!--/notypo--></div>
<br />
b. Порты аутентификации и&nbsp;регистрации на&nbsp;сервере. Например, как&nbsp;показано ниже:<br />
<div class="indent"><!--notypo-->AuthPort 1912<!--/notypo--><br />
<!--notypo-->AcctPort 1913<!--/notypo--></div>
<br />
2. Создать файл загрузки карточного радиус-процесса<br />
Зайдите в&nbsp;директорию “/etc/init.d/” выполнив следующую команду:<br />
<div class="indent">cd /etc/init.d/</div>
<br />
создайте файл “card.sh”, например, выполнив следующую команду:<br />
<div class="indent">vi card.sh</div>
<br />
и&nbsp;внесите в&nbsp;этот файл следующие данные:<br />
<!--notypo--><textarea class="code" rows="33" readonly="readonly">CONFIG_AUTH=/usr/local/billing/radius/card.cfg
RADIUS=/usr/local/billing/bin/radiusd
. /usr/local/billing/etc/bill_util.cfg
PIDFILE_AUTH=$PREFIX/radius/rad_card.pid
log=$PREFIX/radius/card.log
case &quot;$1&quot; in
start)
if [ -f $PIDFILE_AUTH ]; then
rad_pid=`cat $PIDFILE_AUTH`
kill $rad_pid
rm -f $PIDFILE_AUTH
fi
echo -n &quot;Starting authorize radiusd: &quot;
nice -n -3 sudo -u ipstudio $RADIUS -config_file $CONFIG_AUTH -pid_file $PIDFILE_AUTH -log_file $log
touch $PIDFILE_AUTH
echo
;;
stop)
echo -n &quot;Shutting down authorize radiusd: $rad_pid&quot;
rad_pid=`cat $PIDFILE_AUTH`
kill $rad_pid
rm -f $PIDFILE_AUTH
;;
restart)
$0 stop
$0 start
;;
*)
echo &quot;Usage: radiusd {start|stop|restart}&quot;
exit 1
esac
exit 0</textarea><!--/notypo--><br />
<br />
3. После того как&nbsp;стартовый скрипт будет создан, его&nbsp;нужно сделать исполняемым:<br />
<div class="indent">chmod 755 /etc/init.d/card.sh</div>
<br />
4. Нужно будет перезапустить радиус на&nbsp;AMBS-сервере, выполнив следующие команды:<br />
<div class="indent">/etc/init.d/radius.sh stop<br />
/etc/init.d/radius.sh start<br />
/etc/init.d/card.sh start</div>
<br />
5. После запуска в&nbsp;списке запущенных радиус-процессов у&nbsp;вас должен появится карточный радиус процесс:<br />
<div class="indent">ps ax&nbsp;| grep radius</div>
<br />
<!--notypo--><!--/notypo-->14895?         S&lt;     1:17 /usr/local/billing/bin/radiusd -config_file /usr/local/billing/radius/radius.cfg -pid_file /usr/local/billing/radius/radius.pid<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo-->14896?         S&lt;     1:24 /usr/local/billing/bin/radiusd -config_file /usr/local/billing/radius/radius.cfg -pid_file /usr/local/billing/radius/radius.pid<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo-->14897?         S&lt;     1:22 /usr/local/billing/bin/radiusd -config_file /usr/local/billing/radius/radius.cfg -pid_file /usr/local/billing/radius/radius.pid<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo-->14898?         S&lt;     1:18 /usr/local/billing/bin/radiusd -config_file /usr/local/billing/radius/radius.cfg -pid_file /usr/local/billing/radius/radius.pid<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo-->16011?         S&lt;s    0:00 /usr/local/billing/bin/radiusd -config_file /usr/local/billing/radius/card.cfg -pid_file /usr/local/billing/radius/rad_card.pid -log_file /usr/local/billing/radius/card.log<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo-->16014 pts/1    S+     0:00 grep rad<!--notypo--><!--/notypo--><br />
<br />
Теперь можно приступать к&nbsp;настройке карточной платформы непосредственно в&nbsp;самом IP&nbsp;Studio AMBS.<br />
<br />
При&nbsp;необходимости можно добавить ссылку на&nbsp;скрипт запуска карточного радиуса для&nbsp;автоматического старта радиуса при&nbsp;запуске сервера:<br />
<div class="indent">cd /etc/rc3.d<br />
ln&nbsp;-s /etc/init.d/card.sh /etc/rc3.d/S98card.sh<br />
ls&nbsp;-la</div>
<br />
Результат должен иметь вид:<br />
<!--notypo--><!--/notypo-->lrwxrwxrwx   1 root root   20 Jun&nbsp;9 07:41 S98billing.sh -&gt; ../init.d/billing.sh<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo-->lrwxrwxrwx   1 root root   20 Jun&nbsp;11 08:52 S98card.sh -&gt; /etc/init.d/card.sh<!--notypo--><!--/notypo--><br />
<br />
Скрипт запуска радиуса должен обязательно идти после основного скрипта запуска АМБС.<br />
<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo--><br />
<div class="action"><div class="action-content"><table class="dtable" border="0">
<tr class="userrow"><td class="usercell"><strong><a name="cardsplatformorg" href="http://78.46.73.113/wiki/wakka.php?wakka=AmbsCardsManual/CardsPlatformOrg&amp;v=12so" class="" title="AmbsCardsManual/Cards&nbsp;Platform&nbsp;Org">&lt;&lt; Назад</a></strong></td><td class="usercell"> <strong><a href="#PageTopLink" name="oPageTopLink">< Наверх ></a></strong></td><td  class="usercell"><strong><a name="cardsambssettings" href="http://78.46.73.113/wiki/wakka.php?wakka=AmbsCardsManual/CardsAMBSSettings&amp;v=m6n" class="" title="AmbsCardsManual/Cards&nbsp;AMBS&nbsp;Settings">Вперед &gt;&gt;</a></strong></td></tr>
</table></div></div></div>
</body>
<!-- Mirrored from 78.46.73.113/wiki/wakka.php?wakka=AmbsCardsManual/CardsRadiusStart/print by HTTrack Website Copier/3.x [XR&CO'2006], Wed, 25 Jul 2012 16:15:38 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=windows-1251"><!-- /Added by HTTrack -->
</html>