
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from 78.46.73.113/wiki/wakka.php?wakka=AmbsCardsManual/CardsRadiusStart&v=1br by HTTrack Website Copier/3.x [XR&CO'2006], Wed, 25 Jul 2012 16:13:34 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=windows-1251"><!-- /Added by HTTrack -->
<head>
  <title>
  	IpstudioWiki : Ambs&nbsp;Cards&nbsp;Manual&nbsp;/&nbsp;Cards&nbsp;Radius&nbsp;Start  </title>
			  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <meta http-equiv="content-type" content="text/html; charset=windows-1251" />
  <link rel="stylesheet" type="text/css" href="themes/default/css/wakka.css" />
  <link rel="shortcut icon" href="themes/default/icons/wacko.ico" type="image/x-icon" />
  <link rel="alternate" type="application/rss+xml" title="RecentChanges in RSS" href="xml/recentchanges_ipstudiowiki.xml" />
  <link rel="alternate" type="application/rss+xml" title="History/revisions of AmbsCardsManual/CardsRadiusStart in RSS" href="wakkab859.php?wakka=AmbsCardsManual/CardsRadiusStart/revisions.xml" />

<script language="JavaScript" type="text/javascript" src="js/default.js"></script>
<script language="JavaScript" type="text/javascript" src="js/protoedit.js"></script>
<script language="JavaScript" type="text/javascript" src="js/wikiedit2.js"></script>

</head>

<body onload="all_init();" leftmargin="0" topmargin="0" rightmargin="0" bottommargin="0">

<table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td>

<form action="http://78.46.73.113/wiki/wakka.php?wakka=Login"  method="post" >
<input type="hidden" name="wakka" value="Login" />
<input type="hidden" name="action" value="login" />
<div class="header">
  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
  	<tr>
  		<td align="left" class="logo_header">
  		
  		</td>
  		<td align="right" valign="top" class="logo_header"> 
								<span>
					<a href="wakka6b42.html?wakka=Login">
						<b>Вход</b>
					</a>
				</span>
				<!-- <span class="nobr"><input type="hidden" name="goback" value="AmbsCardsManual/CardsRadiusStart" 
				/><strong>Вход:&nbsp;</strong><input 
				type="text" name="name" size="18" class="login" />&nbsp;Пароль:&nbsp;<input type="password" name="password"  
				class="login" size="8" />&nbsp;<input type="image" 
				src="http://78.46.73.113/wiki/themes/default/icons/login.gif" alt=">>>" align="top" /></span>-->
							</td>
		</tr>
		<tr>
			<td colspan="2" class="bookmarks">
							</td>
		</tr>
		<tr>
			<td colspan="2" class="logo_header">
				<b>
				<!--     <span class="main">IpstudioWiki:</span> -->
				     <span class="main"><a href="wakkad0e2.html?wakka=KnowledgeBase">Knowledge&nbsp;Base</a></span>
								     <span class="main">:: <a  href="wakkab5bd.html?wakka=AmbsCardsManual&amp;v=orj" class="" title="Ambs&nbsp;Cards&nbsp;Manual">AmbsCardsManual</a>/CardsRadiusStart</span>     
								</b>
				<!--     <span class="main"><a class="Search" title="" 
				     href="http://78.46.73.113/wiki/wakka.php?wakka=TextSearch&amp;phrase=AmbsCardsManual%2FCardsRadiusStart">...</a></span> -->
				</td>
			</tr>
		</table>
</form>

<div class="pageBefore">
	<img src="images/z.gif" width="1" height="1" border="0" alt="" style="display:block" align="top" />
</div><div class="page">
<a name="p-1771-1"></a><p class="auto" id="p-1771-1"><!--notypo--><a name="PageTopLink" href="#PageTopLink" title=""></a>
<!--/notypo--></p><a name="h201-1"></a><h1>Карточный модуль IP&nbsp;Studio AMBS</h1>
<br /><a name="p-1771-2"></a><p class="auto" id="p-1771-2">
<strong> <a name=".ambscardsmanual" href="wakkab5bd.html?wakka=AmbsCardsManual&amp;v=orj" class="" title="Ambs&nbsp;Cards&nbsp;Manual">В оглавление</a> </strong></p><ul><li> <a name="cardsreview" href="wakkac115.html?wakka=AmbsCardsManual/CardsReview&amp;v=1571" class="" title="AmbsCardsManual/Cards&nbsp;Review">Введение в&nbsp;карточный модуль</a>
</li><li> <a name="cardsconnscheme" href="wakka9a0f.html?wakka=AmbsCardsManual/CardsConnScheme&amp;v=joc" class="" title="AmbsCardsManual/Cards&nbsp;Conn&nbsp;Scheme">Схема взаимодействия системы IP&nbsp;Studio AMBS с&nbsp;карточной платформой</a>
</li><li> <a name="cardsplatformorg" href="wakka57a2.html?wakka=AmbsCardsManual/CardsPlatformOrg&amp;v=12so" class="" title="AmbsCardsManual/Cards&nbsp;Platform&nbsp;Org">Организация работы карточной платформы</a>
</li><li> <a href="#CardsRadiusStart" name="oCardsRadiusStart">Запуск карточного радиус-процесса</a>
</li><li> <a name="cardsambssettings" href="wakkaf81b.html?wakka=AmbsCardsManual/CardsAMBSSettings&amp;v=m6n" class="" title="AmbsCardsManual/Cards&nbsp;AMBS&nbsp;Settings">Настройка карточной платформы в&nbsp;системе IP&nbsp;Studio AMBS</a></li></ul><a name="p-1771-3"></a><p class="auto" id="p-1771-3">
<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo--><br />
<!--notypo--><a name="CardsRadiusStart" href="#CardsRadiusStart" title=""></a>
<!--/notypo--></p><a name="h201-2"></a><h2>Запуск карточного радиус-процесса</h2>
<br /><a name="p-1771-4"></a><p class="auto" id="p-1771-4">
Для&nbsp;того чтобы запустить дополнительно радиус-процесс для&nbsp;карточной платформы, следует выполнить следующие два&nbsp;действия:<br />
1. Создать файл конфигурации карточного модуля “card.cfg”.<br />
Зайдите в&nbsp;папку с&nbsp;настройками радиус процесса:</p><div class="indent">cd /usr/local/billing/radius/</div>
<br /><a name="p-1771-5"></a><p class="auto" id="p-1771-5">
создайте файл “card.cfg”, например выполнив следующую команду:</p><div class="indent">vi card.cfg</div>
<br /><a name="p-1771-6"></a><p class="auto" id="p-1771-6">
после этого, внесите в&nbsp;этот файл следующие данные:<br />
<!--notypo--><textarea class="code" rows="15" readonly="readonly">LogDir /usr/local/billing/radius/
DbDir /usr/local/billing/radius/
# User a lower trace level in production systems:
Trace 2
AuthPort 1912
AcctPort 1913
# You will probably want to change this to suit your site.
&lt;Client DEFAULT&gt;
Secret voipcard
DupInterval 0
&lt;/Client&gt;
&lt;Realm DEFAULT&gt;
&lt;AuthBy CARD&gt;
DBSource dbi:mysql:database=voip;host=ххх.ххх.ххх.ххх;port=3306
DBUsername voip
DBAuth djbg123
CP_LOG_FILE %Lcardlog%y%m%d.%H
ACC_LOG_FILE %Lcdr%y%m%d.%H
LOCK_FILE %Lradius.lock
CREDIT_TIME 1800
FREE_TIME 60
MAX_SEANS 16
CREDIT_SEANS 16
&lt;/AuthBy&gt;
&lt;/Realm&gt;</textarea><!--/notypo--><br />
В&nbsp;этих данных вам&nbsp;нужно изменить следующие данные на&nbsp;ваши реальные:</p><br /><a name="p-1771-7"></a><p class="auto" id="p-1771-7">
a. Адрес вашего хоста, на&nbsp;котором стоит база системы IP&nbsp;Studio AMBS в&nbsp;строке:</p><div class="indent"><!--notypo-->DBSource dbi:mysql:database=voip;host=ХХХ.ХХХ.ХХХ.ХХХ;port=3306<!--/notypo--></div>
<br /><a name="p-1771-8"></a><p class="auto" id="p-1771-8">
b. Порты аутентификации и&nbsp;регистрации на&nbsp;сервере. Например, как&nbsp;показано ниже:</p><div class="indent"><!--notypo-->AuthPort 1912<!--/notypo--><br />
<!--notypo-->AcctPort 1913<!--/notypo--></div>
<br /><a name="p-1771-9"></a><p class="auto" id="p-1771-9">
2. Создать файл загрузки карточного радиус-процесса<br />
Зайдите в&nbsp;директорию “/etc/init.d/” выполнив следующую команду:</p><div class="indent">cd /etc/init.d/</div>
<br /><a name="p-1771-10"></a><p class="auto" id="p-1771-10">
создайте файл “card.sh”, например, выполнив следующую команду:</p><div class="indent">vi card.sh</div>
<br /><a name="p-1771-11"></a><p class="auto" id="p-1771-11">
и&nbsp;внесите в&nbsp;этот файл следующие данные:<br />
<!--notypo--><textarea class="code" rows="15" readonly="readonly">CONFIG_AUTH=/usr/local/billing/radius/card.cfg
RADIUS=/usr/local/billing/bin/radiusd
. /usr/local/billing/etc/bill_util.cfg
PIDFILE_AUTH=$PREFIX/radius/rad_card.pid
log=$PREFIX/radius/card.log
case &quot;$1&quot; in
start)
if [ -f $PIDFILE_AUTH ]; then
rad_pid=`cat $PIDFILE_AUTH`
kill $rad_pid
rm -f $PIDFILE_AUTH
fi
echo -n &quot;Starting authorize radiusd: &quot;
nice -n -3 sudo -u ipstudio $RADIUS -config_file $CONFIG_AUTH -pid_file $PIDFILE_AUTH -log_file $log
touch $PIDFILE_AUTH
echo
;;
stop)
echo -n &quot;Shutting down authorize radiusd: $rad_pid&quot;
rad_pid=`cat $PIDFILE_AUTH`
kill $rad_pid
rm -f $PIDFILE_AUTH
;;
restart)
$0 stop
$0 start
;;
*)
echo &quot;Usage: radiusd {start|stop|restart}&quot;
exit 1
esac
exit 0</textarea><!--/notypo--></p><br /><a name="p-1771-12"></a><p class="auto" id="p-1771-12">
3. После того как&nbsp;стартовый скрипт будет создан, его&nbsp;нужно сделать исполняемым:</p><div class="indent">chmod 755 /etc/init.d/card.sh</div>
<br /><a name="p-1771-13"></a><p class="auto" id="p-1771-13">
4. Нужно будет перезапустить радиус на&nbsp;AMBS-сервере, выполнив следующие команды:</p><div class="indent">/etc/init.d/radius.sh stop<br />
/etc/init.d/radius.sh start<br />
/etc/init.d/card.sh start</div>
<br /><a name="p-1771-14"></a><p class="auto" id="p-1771-14">
5. После запуска в&nbsp;списке запущенных радиус-процессов у&nbsp;вас должен появится карточный радиус процесс:</p><div class="indent">ps ax&nbsp;| grep radius</div>
<br /><a name="p-1771-15"></a><p class="auto" id="p-1771-15">
<!--notypo--><!--/notypo-->14895?         S&lt;     1:17 /usr/local/billing/bin/radiusd -config_file /usr/local/billing/radius/radius.cfg -pid_file /usr/local/billing/radius/radius.pid<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo-->14896?         S&lt;     1:24 /usr/local/billing/bin/radiusd -config_file /usr/local/billing/radius/radius.cfg -pid_file /usr/local/billing/radius/radius.pid<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo-->14897?         S&lt;     1:22 /usr/local/billing/bin/radiusd -config_file /usr/local/billing/radius/radius.cfg -pid_file /usr/local/billing/radius/radius.pid<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo-->14898?         S&lt;     1:18 /usr/local/billing/bin/radiusd -config_file /usr/local/billing/radius/radius.cfg -pid_file /usr/local/billing/radius/radius.pid<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo-->16011?         S&lt;s    0:00 /usr/local/billing/bin/radiusd -config_file /usr/local/billing/radius/card.cfg -pid_file /usr/local/billing/radius/rad_card.pid -log_file /usr/local/billing/radius/card.log<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo-->16014 pts/1    S+     0:00 grep rad<!--notypo--><!--/notypo--></p><br /><a name="p-1771-16"></a><p class="auto" id="p-1771-16">
Теперь можно приступать к&nbsp;настройке карточной платформы непосредственно в&nbsp;самом IP&nbsp;Studio AMBS.</p><br /><a name="p-1771-17"></a><p class="auto" id="p-1771-17">
При&nbsp;необходимости можно добавить ссылку на&nbsp;скрипт запуска карточного радиуса для&nbsp;автоматического старта радиуса при&nbsp;запуске сервера:</p><div class="indent">cd /etc/rc3.d<br />
ln&nbsp;-s /etc/init.d/card.sh /etc/rc3.d/S98card.sh<br />
ls&nbsp;-la</div>
<br /><a name="p-1771-18"></a><p class="auto" id="p-1771-18">
Результат должен иметь вид:<br />
<!--notypo--><!--/notypo-->lrwxrwxrwx   1 root root   20 Jun&nbsp;9 07:41 S98billing.sh -&gt; ../init.d/billing.sh<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo-->lrwxrwxrwx   1 root root   20 Jun&nbsp;11 08:52 S98card.sh -&gt; /etc/init.d/card.sh<!--notypo--><!--/notypo--></p><br /><a name="p-1771-19"></a><p class="auto" id="p-1771-19">
Скрипт запуска радиуса должен обязательно идти после основного скрипта запуска АМБС.<br />
<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo--></p><div class="action"><div class="action-content"><table class="dtable" border="0">
<tr class="userrow"><td class="usercell"><strong><a name="cardsplatformorg" href="http://www.ipstudio.net/wiki/wakka.php?wakka=AmbsCardsManual/CardsPlatformOrg&amp;v=12so" class="" title="AmbsCardsManual/Cards&nbsp;Platform&nbsp;Org">&lt;&lt; Назад</a></strong></td><td class="usercell"> <strong><a href="#PageTopLink" name="oPageTopLink">< Наверх ></a></strong></td><td  class="usercell"><strong><a name="cardsambssettings" href="http://www.ipstudio.net/wiki/wakka.php?wakka=AmbsCardsManual/CardsAMBSSettings&amp;v=m6n" class="" title="AmbsCardsManual/Cards&nbsp;AMBS&nbsp;Settings">Вперед &gt;&gt;</a></strong></td></tr>
</table></div></div>   <script language="JavaScript" type="text/javascript">
   var dbclick = "page";
  </script>
 <br style="clear:both" />&nbsp;
</div>

<form action="http://78.46.73.113/wiki/wakka.php?wakka=TextSearch"  method="get" >
<input type="hidden" name="wakka" value="TextSearch" />
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="footer">
	<tr>
		<td>
			 
			
			  <span class="searchbar nobr">Поиск: <input type="text" name="phrase" size="25" style="border: none; border-bottom: 1px solid #CCCCAA; padding: 0px; margin: 0px;" /></span>
		</td>
		<td align="right">
			<a href="wakka3887.html?wakka=AmbsCardsManual/CardsRadiusStart/print" target="_new"><img src="themes/default/icons/1print.gif" title="Версия для печати" alt="Версия для печати"  align="middle" border="0" /></a>		</td>
	</tr>
</table>

</form>


<table class="copyright" width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
	<tr>
		<td align="left" class="copyright">
			Created by <a target="_blank" class="copyright" href="http://www.ipstudio.net/">IP Studio Inc.</a>© 2007
		</td>
		<td align="right" class="copyright">
			Powered by <a href="http://wackowiki.com/WackoWiki" target="_blank" title="" class="outerlink">WackoWiki R4.2</a>		</td>
	</tr>
</table>

</td>
</tr>
</table>
</body>
<!-- Mirrored from 78.46.73.113/wiki/wakka.php?wakka=AmbsCardsManual/CardsRadiusStart&v=1br by HTTrack Website Copier/3.x [XR&CO'2006], Wed, 25 Jul 2012 16:13:34 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=windows-1251"><!-- /Added by HTTrack -->
</html>