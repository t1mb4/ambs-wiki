<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>

<!-- Mirrored from 78.46.73.113/wiki/wakka.php?wakka=NastrojjkaSkriptaProverkiSostojanijaRadiusa/print by HTTrack Website Copier/3.x [XR&CO'2006], Wed, 25 Jul 2012 16:14:25 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=windows-1251"><!-- /Added by HTTrack -->
<head>
  <title>IpstudioWiki : НастройкаСкриптаПроверкиСостоянияRadiusа</title>
<meta name="robots" content="noindex, nofollow" />
  <meta http-equiv="content-type" content="text/html; charset=windows-1251" />
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <link rel="stylesheet" type="text/css" href="http://78.46.73.113/wiki/themes/default/css/wakkaprint.css" />
</head>

<body>

<div class="header">
  IpstudioWiki : <a href="http://78.46.73.113/wiki/wakka.php?wakka=TextSearch?phrase=%CD%E0%F1%F2%F0%EE%E9%EA%E0%D1%EA%F0%E8%EF%F2%E0%CF%F0%EE%E2%E5%F0%EA%E8%D1%EE%F1%F2%EE%FF%ED%E8%FFRadius%E0">НастройкаСкриптаПроверкиСостоянияRadiusа</a> 
</div>

<div class="pageBefore"><img src="http://78.46.73.113/wiki/images/z.gif" width="1" height="1" border="0" alt="" style="display:block" align="top" /></div><div class="page">
<strong> <a name=".knowledgebase" href="http://78.46.73.113/wiki/wakka.php?wakka=KnowledgeBase&amp;v=mpj" class="" title="Knowledge&nbsp;Base">В оглавление</a> </strong><br />
<a name="h227-1"></a><h2>Настройка скрипта проверки состояния Radius-а</h2>
<br />
Описание настройки дополнительного внешнего скрипта для&nbsp;регулярной проверки состояния демона АМБС и&nbsp;процесса радиуса.<br />
<br />
1. Проверьте наличие файлов скрипта проверки: <br />
<div class="indent"><div class="indent">ls -la billing/scripts/check.sh<br />
ls&nbsp;-la billing/bin/defradpwtst.pl</div></div>
<br />
 Если таких файлов нет, скачайте их&nbsp;с сервера обновлений АМБС:<br />
<div class="indent"><div class="indent">scp -r billinst@213.219.246.22:scripts /usr/local/billing/<br />
scp&nbsp;billinst@213.219.246.22:bin/defradpwtst.pl /usr/local/billing/bin/<br />
chmod +x /usr/local/billing/scripts/* <br />
chown -R ipstudio /usr/local/billing</div></div>
<br />
2. Добавьте в&nbsp;Cron сервера команды на&nbsp;запуск проверки. Выполните в&nbsp;консоли сервера последовательно следующие команды:<br />
<div class="indent"><div class="indent">echo &gt;&gt; /etc/crontab; <br />
echo "#IP Studio Radius Live Check" &gt;&gt; /etc/crontab; <br />
echo "*/15 * * * * root /usr/local/billing/scripts/check.sh &gt;&gt; /usr/local/billing/logs/defradpwtst.log 2&gt;&1"&gt;&gt; /etc/crontab;<br />
echo &gt;&gt; /etc/crontab;</div></div>
<br />
 Если используете карточный модуль добавить также: <br />
<div class="indent"><div class="indent">echo "*/20 * * * * root /usr/local/billing/scripts/cardradchk.sh &gt;&gt; /usr/local/billing/logs/defradpwtst.log 2&gt;&1"&gt;&gt; /etc/crontab; <br />
echo &gt;&gt; /etc/crontab;</div></div>
<br />
3. Перезапустите Cron сервера:<br />
<div class="indent"><div class="indent">/etc/init.d/crond restart  </div></div>
<br />
4. Отредактировать скрипт указать почтовый адрес куда скрипт будет присылать письма в&nbsp;случае возникновения ошибок.<br />
<div class="indent">vi /usr/local/billing/scripts/check.sh</div>
<br />
<div class="indent">исправить значение строки: <br />
MAIL_TO='admin@mydomain.com'</div>
<br />
Cервер будет регулярно выполнять скрипт &laquo;billing/scripts/check.sh&raquo; каждые 15 минут в&nbsp;течении суток. <br />
Скрипт выполняет следующие действия: <br />
<ul><li> Проверяет наличие активных процессов &#147;bill_sig_svr.pl&#148;, если такие отсутствуют &ndash; перезапускает демона АМБС.
</li><li> Обращается к&nbsp;радиусу и&nbsp;инициирует пустой запрос на&nbsp;авторизацию, если радиус не&nbsp;отвечает &ndash; перезапускает радиус.
</li><li> Результаты проверки скрипт будет записывать в&nbsp;лог-файл &laquo;billing/logs/defradpwtst.log&raquo;</li></ul>
<br />
<strong> <a  href="http://78.46.73.113/wiki/wakka.php?wakka=KnowledgeBase&amp;v=mpj" class="" title="Knowledge&nbsp;Base">В оглавление</a> </strong><br />
 <br /></div>
</body>
<!-- Mirrored from 78.46.73.113/wiki/wakka.php?wakka=NastrojjkaSkriptaProverkiSostojanijaRadiusa/print by HTTrack Website Copier/3.x [XR&CO'2006], Wed, 25 Jul 2012 16:14:25 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=windows-1251"><!-- /Added by HTTrack -->
</html>