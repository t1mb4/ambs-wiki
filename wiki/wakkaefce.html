<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>

<!-- Mirrored from 78.46.73.113/wiki/wakka.php?wakka=ChastyeVoprosyIotvetyPoAMBS/VoprosyPoustanovkeAMBS/print by HTTrack Website Copier/3.x [XR&CO'2006], Wed, 25 Jul 2012 16:14:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=windows-1251"><!-- /Added by HTTrack -->
<head>
  <title>IpstudioWiki : ЧастыеВопросыИответыПоАМБС/ВопросыПоустановкеAMBS</title>
<meta name="robots" content="noindex, nofollow" />
  <meta http-equiv="content-type" content="text/html; charset=windows-1251" />
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <link rel="stylesheet" type="text/css" href="http://78.46.73.113/wiki/themes/default/css/wakkaprint.css" />
</head>

<body>

<div class="header">
  IpstudioWiki : <a href="http://78.46.73.113/wiki/wakka.php?wakka=TextSearch?phrase=%D7%E0%F1%F2%FB%E5%C2%EE%EF%F0%EE%F1%FB%C8%EE%F2%E2%E5%F2%FB%CF%EE%C0%CC%C1%D1%2F%C2%EE%EF%F0%EE%F1%FB%CF%EE%F3%F1%F2%E0%ED%EE%E2%EA%E5AMBS">ЧастыеВопросыИответыПоАМБС/ВопросыПоустановкеAMBS</a> 
</div>

<div class="pageBefore"><img src="http://78.46.73.113/wiki/images/z.gif" width="1" height="1" border="0" alt="" style="display:block" align="top" /></div><div class="page">
<a name="h108-1"></a><h1><!--notypo-->ЧаВО<!--/notypo--> по&nbsp;IP Studio AMBS</h1>
<br />
<strong> <a name=".." href="http://78.46.73.113/wiki/wakka.php?wakka=ChastyeVoprosyIotvetyPoAMBS&amp;v=17ko" class="" title="ЧастыеВопросыИответыПоАМБС/..">В оглавление</a> </strong><br />
<ul><li> <a name="obshhajainformacijapoambs" href="http://78.46.73.113/wiki/wakka.php?wakka=ChastyeVoprosyIotvetyPoAMBS/ObshhajaInformacijaPoAMBS&amp;v=p20" class="" title="ЧастыеВопросыИответыПоАМБС/Общая&nbsp;Информация&nbsp;По&nbsp;AMBS">Общая информация по&nbsp;IP Studio AMBS</a>
</li><li> <a name="voprosypoustanovkeambs" href="http://78.46.73.113/wiki/wakka.php?wakka=ChastyeVoprosyIotvetyPoAMBS/VoprosyPoustanovkeAMBS&amp;v=osy" class="" title="ЧастыеВопросыИответыПоАМБС/Вопросы&nbsp;Поустановке&nbsp;AMBS">Технические вопросы по&nbsp;системе</a>
</li><li> <a name="rabotacoperatorami" href="http://78.46.73.113/wiki/wakka.php?wakka=ChastyeVoprosyIotvetyPoAMBS/RabotaCoperatorami&amp;v=16or" class="" title="ЧастыеВопросыИответыПоАМБС/Работа&nbsp;Cоператорами">Операторы и&nbsp;их параметры</a>
</li><li> <a name="rabotastarifami" href="http://78.46.73.113/wiki/wakka.php?wakka=ChastyeVoprosyIotvetyPoAMBS/RabotaStarifami&amp;v=5yh" class="" title="ЧастыеВопросыИответыПоАМБС/Работа&nbsp;Старифами">Тарифные планы, валюты, цены и&nbsp;направления</a>
</li><li> <a name="rabotasshljuzami" href="http://78.46.73.113/wiki/wakka.php?wakka=ChastyeVoprosyIotvetyPoAMBS/RabotaSshljuzami&amp;v=xe5" class="" title="ЧастыеВопросыИответыПоАМБС/Работа&nbsp;Сшлюзами">Радиус: шлюзы, маршрутизация, трансляция</a> 
</li><li> <a name="mvtsvoprosy" href="http://78.46.73.113/wiki/wakka.php?wakka=ChastyeVoprosyIotvetyPoAMBS/MvtsVoprosy&amp;v=61q" class="" title="ЧастыеВопросыИответыПоАМБС/Mvts&nbsp;Вопросы">MVTS: конфиги, обновление, статистика, sip-hit</a></li></ul>
<a name="h108-2"></a><h2>Технические вопросы по&nbsp;системе</h2>
<br />
<br />
<ul><li> <u><a href="#TECHTT1" name="oTECHTT1">Какой нужен сервер для&nbsp;установки системы IP&nbsp;Studio AMBS?</a></u>
</li><li> <u><a href="#TECHTT2" name="oTECHTT2">Как проверить правильно ли&nbsp;работает система?</a></u>
</li><li> <u><a href="#TECHTT3" name="oTECHTT3">Как перезапустить IP&nbsp;Studio AMBS?</a></u>
</li><li> <u><a href="#TECHTT3a" name="oTECHTT3a">Как добавить Меру и&nbsp;проверить правильно ли&nbsp;добавил?</a></u>
</li><li> <u><a href="#TECHTT4" name="oTECHTT4">Мы завели новую Меру, как&nbsp;можно скопировать на&nbsp;нее шлюзы всех операторов, которые уже&nbsp;есть в&nbsp;системе для&nbsp;другой Меры?</a></u>
</li><li> <u><a href="#TECHTT5" name="oTECHTT5">Где можно посмотреть логи работы AMBS?</a></u>
</li><li> <u><a href="#TECHTT6" name="oTECHTT6">Хотим сменить ip-адрес АМБС-сервера, сам&nbsp;сервер остается прежний. Какие шаги нужно предпринять?</a></u>
</li><li> <u><a href="#TECHTT7" name="oTECHTT7">Можно ли&nbsp;называть шлюзы, роуты операторов на&nbsp;русском языке, система поддерживает кирилицу?</a></u>
</li><li> <u><a href="#TECHTT8" name="oTECHTT8">Как проверить состояние буфера загрузки новых звонков в&nbsp;базу АМБС?</a></u></li></ul>
<br />
<hr noshade="noshade" size="1" />
<br />
<!--notypo--><a name="TECHTT1" href="#TECHTT1" title=""></a>
<!--/notypo--><strong>Вопрос: Какой нужен сервер для&nbsp;установки системы IP&nbsp;Studio AMBS?</strong><br />
<br />
<strong>Ответ:</strong> Для&nbsp;установки системы IP&nbsp;Studio AMBS ваш&nbsp;веб-сервер должен удовлетворять следующим требованиям: <strong><u><a name=".dokumentacijaipstudioambs.ustanovkanastrojjkaipstudioambs" href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS&amp;v=jxa#Техническиетребования" class="" title="Документация&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Установка&nbsp;Настройка&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/">Читаем</a></u></strong><br />
<br />
<hr noshade="noshade" size="1" />
<br />
<!--notypo--><a name="TECHTT2" href="#TECHTT2" title=""></a>
<!--/notypo--><strong>Вопрос: Как&nbsp;проверить правильно ли&nbsp;работает система?</strong><br />
<br />
<strong>Ответ:</strong> На&nbsp;сервере c&nbsp;&#147;IP Studio AMBS&#148; должны выполняются следующие процессы: <strong><u><a name=".dokumentacijaipstudioambs.ustanovkanastrojjkaipstudioambs.proverkaprocessovambs" href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS/ProverkaProcessovAMBS&amp;v=1asm" class="" title="Документация&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Установка&nbsp;Настройка&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Проверка&nbsp;Процессов&nbsp;AMBS">Читаем</a></u></strong><br />
<br />
<hr noshade="noshade" size="1" />
<br />
<!--notypo--><a name="TECHTT3" href="#TECHTT3" title=""></a>
<!--/notypo--><strong>Вопрос: Как&nbsp;перезапустить IP&nbsp;Studio AMBS?</strong><br />
<br />
<strong>Ответ:</strong><br />
<br />
В&nbsp;консоли сервера выполняете следующие команды:<br />
<br />
1. Остановить биллинг и&nbsp;все его&nbsp;процессы:<br />
<div class="indent"><!--notypo-->/etc/init.d/billing.sh stop<!--/notypo--></div>
<br />
2. Проверяете, что&nbsp;все процессы остановилось:<br />
<div class="indent"><!--notypo-->ps ax | grep pl<!--/notypo--><br />
<!--notypo-->ps ax | grep rad<!--/notypo--><br />
<!--notypo-->ps ax | grep mysql<!--/notypo--></div>
<br />
Если какой то&nbsp;из процессов продолжает работать, его&nbsp;нужно сбросить через команду &ndash; &#147;kill -9 PID&#148;.<br />
<br />
3. Запустить АМБС:<br />
<div class="indent"><!--notypo-->/etc/init.d/billing.sh start<!--/notypo--></div>
<br />
4. Проверяете, что&nbsp;все процессы запустились:<br />
<div class="indent"><!--notypo-->ps ax | grep pl<!--/notypo--> <br />
<!--notypo-->ps ax | grep rad<!--/notypo--><br />
<!--notypo-->ps ax | grep mysql<!--/notypo--></div>
<br />
<hr noshade="noshade" size="1" />
<br />
<!--notypo--><a name="TECHTT3a" href="#TECHTT3a" title=""></a>
<!--/notypo--><strong>Вопрос: Как&nbsp;добавить Меру и&nbsp;проверить правильно ли&nbsp;добавил?</strong><br />
<br />
<strong>Ответ:</strong> <br />
<br />
Прежде всего нужно <strong><u><a name=".dokumentacijaipstudioambs.ustanovkanastrojjkaipstudioambs.podkljuchenieudalennojjmery" href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/UstanovkaNastrojjkaIPStudioAMBS/PodkljuchenieUdalennojjMery&amp;v=n1v" class="" title="Документация&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Установка&nbsp;Настройка&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Подключение&nbsp;Удаленной&nbsp;Меры">загрузить скрипты АМБС на&nbsp;сервер Меры</a></u></strong> (если Мера удаленная) и&nbsp;<strong><u><a name=".dokumentacijaipstudioambs.razdelequipments.formamvtsservers" href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/RazdelEquipments/FormaMvtsServers&amp;v=219" class="" title="Документация&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Раздел&nbsp;Equipments&nbsp;/&nbsp;Форма&nbsp;Mvts&nbsp;Servers">завести Меру в&nbsp;форме АМБС</a></u></strong>.<br />
На&nbsp;втором рисунке показан рабочий пример, можно заполнить форму по&nbsp;аналогии изменив адреса на&nbsp;реальные.<br />
<br />
Подключение к&nbsp;удаленной Мере рекомендуем организовывать по&nbsp;протоколу sftp, это&nbsp;гарантирует стабильность и&nbsp;безопасность.<br />
Инструкцию, как&nbsp;организовать подключение можете найти на&nbsp;следующей странице: <strong><u><a name=".dokumentacijaipstudioambs.razdelequipments.formamvtsservers.instrukcijasftp" href="http://78.46.73.113/wiki/wakka.php?wakka=DokumentacijaIPStudioAMBS/RazdelEquipments/FormaMvtsServers/InstrukcijaSftp&amp;v=lyc" class="" title="Документация&nbsp;IP&nbsp;Studio&nbsp;AMBS&nbsp;/&nbsp;Раздел&nbsp;Equipments&nbsp;/&nbsp;Форма&nbsp;Mvts&nbsp;Servers&nbsp;/&nbsp;Инструкция&nbsp;Sftp">Читаем</a></u></strong><br />
<br />
Как&nbsp;проверить конфигурационные файлы Меры, читаем: <strong><u><a  href="http://78.46.73.113/wiki/wakka.php?wakka=ChastyeVoprosyIotvetyPoAMBS/MvtsVoprosy&amp;v=61q#MVTSTT1" class="" title="ЧастыеВопросыИответыПоАМБС/Mvts&nbsp;Вопросы&nbsp;/">Здесь</a></u></strong><br />
<!--notypo--><!--/notypo--><br />
<hr noshade="noshade" size="1" />
<br />
<!--notypo--><a name="TECHTT4" href="#TECHTT4" title=""></a>
<!--/notypo--><strong>Вопрос: Мы&nbsp;завели новую Меру, как&nbsp;можно скопировать на&nbsp;нее шлюзы всех операторов, которые уже&nbsp;есть в&nbsp;системе для&nbsp;другой Меры?</strong><br />
<br />
<strong>Ответ:</strong><br />
<br />
1. В&nbsp;форме &#147;MVTS Servers&#148; (Equipments &ndash; MVTS Servers) нужно выбрать из&nbsp;списка подключенных Мер&nbsp;уже работающую.<br />
<br />
2. Далее, в&nbsp;выпадающем списке &#147;Copy all&nbsp;gates to:" выбрать <u>новую Меру</u>.<br />
<br />
3.  Нажать &#147;Copy gates&#148;.<br />
<br />
Все&nbsp;шлюза операторов будут скопированы со&nbsp;старой Меры на&nbsp;новую.<br />
<br />
<hr noshade="noshade" size="1" />
<br />
<!--notypo--><a name="TECHTT5" href="#TECHTT5" title=""></a>
<!--/notypo--><strong>Вопрос: Где&nbsp;можно посмотреть логи работы AMBS?</strong><br />
<br />
<strong>Ответ:</strong> <u><a name=".primeryrabotysipstudioambs.logiambs" href="http://78.46.73.113/wiki/wakka.php?wakka=PrimeryRabotySipStudioAmbs/LogiAMBS&amp;v=hn6" class="" title="Примеры&nbsp;Работы&nbsp;Сip&nbsp;Studio&nbsp;Ambs&nbsp;/&nbsp;Логи&nbsp;AMBS">&gt; Читаем &lt;</a></u><br />
<br />
<hr noshade="noshade" size="1" />
<br />
<!--notypo--><a name="TECHTT6" href="#TECHTT6" title=""></a>
<!--/notypo--><strong>Вопрос: Хотим сменить ip-адрес АМБС-сервера, сам&nbsp;сервер остается прежний. Какие шаги нужно предпринять?</strong><br />
<br />
<strong>Ответ:</strong><br />
<br />
Если вы&nbsp;хотите сменить только ip-адрес амбс-сервера (сам сервер остается прежний), необходимо сделать следующие шаги:<br />
<br />
1. На&nbsp;адрес тех.поддержки отправить письмо с&nbsp;заявкой и&nbsp;указанием старого и&nbsp;нового адресов АМБС.<br />
<br />
2. После получения ключей на&nbsp;новый адрес, можно переходить к&nbsp;техническим работам.<br />
<br />
3. Сменить адрес в&nbsp;конфигурации ОС&nbsp;и запустить сервер на&nbsp;новом адресе.<br />
<br />
4. После смены адреса положить файлы нового ключа в&nbsp;папку &laquo;/usr/local/billing/var/&raquo;.<br />
<br />
5. Отредактировать файл &laquo;/usr/local/billing/etc/bill_util.cfg&raquo;,  в&nbsp;параметрах &ndash; &#147;HOST&#148; и&nbsp;&#147;MY_IP&#148; указать новый ip-адрес сервера (именно ip-адрес).<br />
<br />
6. Если используется локальный MVTS под&nbsp;управлением АМБС, проверить &#147;meraproxy.cfg&#148; убедиться, что&nbsp;адрес MVTS изменен на&nbsp;новый ip-адрес. <br />
<br />
7. Для&nbsp;<u>локального MVTS</u>. Зайти в&nbsp;АМБС &#147;Equipments &ndash; Servers&#148;. <br />
По&nbsp;аналогии с&nbsp;MVTS на&nbsp;старом адресе, добавить еще&nbsp;один новый MVTS с&nbsp;аналогичными параметрами, но&nbsp;с новым адресом. <br />
<br />
8. В&nbsp;той же&nbsp;форме, выбрать (точкой) MVTS со&nbsp;старым адресом, далее в&nbsp;выпадающем списке &#147;copy all&nbsp;gates to:&raquo; выбрать MVTS с&nbsp;новым адресом <br />
и&nbsp;скопировать на&nbsp;нее все&nbsp;заведенные в&nbsp;системе шлюзы операторов, чтобы не&nbsp;добавлять их&nbsp;в ручную для&nbsp;новой MVTS. <br />
<br />
9. Здесь же, поскольку MVTS со&nbsp;старым адресом больше нет&nbsp;его можно закрыть, изменив статус на&nbsp;&#147;Closed&#148;.<br />
<br />
<strong>Важно</strong>:  Не&nbsp;нужно удалять MVTS со&nbsp;старым адресом, через него проходил трафик, удаление окажет прямое влияние на&nbsp;статистику прошедших звонков. <br />
<br />
10. Если использовались <u>удаленные MVTS</u>, нужно проверить на&nbsp;них:<br />
<ul><li> meraproxy.cfg, поправить адреса в&nbsp;секции Radius, на&nbsp;новый адрес АМБС и&nbsp;перегрузить MVTS.
</li><li> /usr/local/billing/etc/bill_util.cfg поправить поле HOST, указать новый адрес АМБС
</li><li> сбросить (через kill -9 ) и&nbsp;запустить по&nbsp;новой демона АМБС &ndash; bill_sig_svr.pl</li></ul>
<br />
<hr noshade="noshade" size="1" />
<br />
<!--notypo--><a name="TECHTT7" href="#TECHTT7" title=""></a>
<!--/notypo--><strong>Вопрос: Можно ли&nbsp;называть шлюзы, роуты операторов на&nbsp;русском языке, система поддерживает кирилицу?</strong><br />
<br />
<strong>Ответ:</strong><br />
<br />
Да, АМБС поддерживает кирилицу:<br />
<ul><li> Названия шлюзов лучше оставить на&nbsp;латинице, удобнее будет разбирать информацию в&nbsp;консоли на&nbsp;сервере.
</li><li> Названия направлений в&nbsp;тарифных планах можно создавать на&nbsp;кирилице, их&nbsp;названия хранятся в&nbsp;базе и&nbsp;используются только для&nbsp;отображения в&nbsp;веб-интерфейсе.
</li><li> Для&nbsp;названий операторов их&nbsp;реквизитов можно также использовать кирилицу. </li></ul>
<br />
Придерживайтесь золотой середины:<br />
<ul><li> все&nbsp;внутренние названия (названия шлюзов, логины пользователей и&nbsp;т.д.) пишем латиницей,
</li><li> внешние названия, которые будут отправляться партнерам (названия операторов их&nbsp;реквизиты, названия направлений) можно заводить на&nbsp;кирилице.</li></ul>
<br />
Будьте внимательны с&nbsp;кодировкой, Linux и&nbsp;Windows это&nbsp;разные ОС, старайтесь использовать CP1251.<br />
<br />
<hr noshade="noshade" size="1" />
<br />
<!--notypo--><a name="TECHTT8" href="#TECHTT8" title=""></a>
<!--/notypo--><strong>Вопрос: Как&nbsp;проверить состояние буфера загрузки новых звонков в&nbsp;базу АМБС?</strong><br />
<br />
<strong>Ответ:</strong><br />
<br />
&ndash; За&nbsp;работу буфера отвечает процесс &#147;load_buffer.pl&#148;. Если объем звонков  большой, тогда процесс будет присутствовать в&nbsp;активных процессах. <br />
ps&nbsp;ax | grep load_buffer.pl<br />
<br />
&ndash; Если что-нибудь мешает нормальной работе буфера загрузки звонков, ошибки будут записаны в&nbsp;лог работы буфера, в&nbsp;файл &laquo;billing/logs/load_buffer.err&raquo; . 	<br />
less billing/logs/load_buffer.err<br />
<br />
&ndash; Для&nbsp;своей работы буфер использует две&nbsp;&laquo;ротируемые&raquo; таблицы. Одна таблица(CDRBUFFER) используется для&nbsp;получения звонков от&nbsp;радиуса, <br />
в&nbsp;то время как&nbsp;из&nbsp;второй таблицы(CDRBUFFER_READ) данные загружаются в&nbsp;базу. После того как&nbsp;звонки загружены в&nbsp;базу таблицы меняются местами. <br />
Можно посмотреть количество записей в&nbsp;этих таблицах следующими командами:<br />
SELECT COUNT(*) FROM CDRBUFFER;<br />
SELECT COUNT(*) FROM CDRBUFFER_READ;<br />
<br />
&ndash; В&nbsp;процессе работы буфер записывает количество обработанных и&nbsp;занесенных в&nbsp;базу звонков в&nbsp;лог &laquo;billing/logs/ipstudio.log&raquo; <br />
в&nbsp;следующем виде "[load_buffer]: Trace level undefined, Current position:10000"<br />
По&nbsp;этим записям можно отслеживать количество уже&nbsp;обработанных звонков.<br />
tail -n 500 billing/logs/ipstudio.log | grep  'load_buffer'<br />
<br />
Можно скомбинировать запрос количества уже&nbsp;загруженных звонков из&nbsp;лога и&nbsp;выборку общего количества звонков в&nbsp;буферных таблицах, например так: <br />
tail -n 300 ipstudio.log | grep  'load_buffer' | tail -n 1 && mysql -u&lt;имя_mysql_пользователя&gt; -p&lt;пароль_mysql_пользователя&gt; -D voip -e 'select &#147;CDRBUFFER&#148;,count(*) from CDRBUFFER union select &#147;CDRBUFFER_READ&#148;,count(*) from CDRBUFFER_READ;'<br />
<br />
где, <br />
&lt;имя_mysql_пользователя&gt; и&nbsp;&lt;пароль_mysql_пользователя&gt; можно взять из&nbsp;конфиг-файла АМБС (billing/etc/bill_util.cfg, параметры &ndash; USER, PASS).<br />
<br />
Результат получится следующего вида:<br />
<!--notypo--><div class="code"><pre>2010/07/21 12:11:05 [load_buffer]: Trace level undefined<span style="color:#4400DD">,</span> Current position:10000
+----------------+----------+
<span style="color:#4400DD">|</span> CDRBUFFER      <span style="color:#4400DD">|</span> count(*) <span style="color:#4400DD">|</span>
+----------------+----------+
<span style="color:#4400DD">|</span> CDRBUFFER      <span style="color:#4400DD">|</span>      384 <span style="color:#4400DD">|</span>
<span style="color:#4400DD">|</span> CDRBUFFER_READ <span style="color:#4400DD">|</span>      211 <span style="color:#4400DD">|</span>
+----------------+----------+</pre></div><!--/notypo--><br />
<br />
<hr noshade="noshade" size="1" /></div>
</body>
<!-- Mirrored from 78.46.73.113/wiki/wakka.php?wakka=ChastyeVoprosyIotvetyPoAMBS/VoprosyPoustanovkeAMBS/print by HTTrack Website Copier/3.x [XR&CO'2006], Wed, 25 Jul 2012 16:14:17 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=windows-1251"><!-- /Added by HTTrack -->
</html>