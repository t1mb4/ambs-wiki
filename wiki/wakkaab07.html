
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from 78.46.73.113/wiki/wakka.php?wakka=PrimeryRabotySipStudioAmbs/AkkauntingCisco2AMBS&v=17l4 by HTTrack Website Copier/3.x [XR&CO'2006], Wed, 25 Jul 2012 16:10:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=windows-1251"><!-- /Added by HTTrack -->
<head>
  <title>
  	IpstudioWiki : Примеры&nbsp;Работы&nbsp;Сip&nbsp;Studio&nbsp;Ambs&nbsp;/&nbsp;Аккаунтинг&nbsp;Cisco&nbsp;2&nbsp;AMBS  </title>
			  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <meta http-equiv="content-type" content="text/html; charset=windows-1251" />
  <link rel="stylesheet" type="text/css" href="themes/default/css/wakka.css" />
  <link rel="shortcut icon" href="themes/default/icons/wacko.ico" type="image/x-icon" />
  <link rel="alternate" type="application/rss+xml" title="RecentChanges in RSS" href="xml/recentchanges_ipstudiowiki.xml" />
  <link rel="alternate" type="application/rss+xml" title="History/revisions of ПримерыРаботыСipStudioAmbs/АккаунтингCisco2AMBS in RSS" href="wakka2c84.php?wakka=PrimeryRabotySipStudioAmbs/AkkauntingCisco2AMBS/revisions.xml" />

<script language="JavaScript" type="text/javascript" src="js/default.js"></script>
<script language="JavaScript" type="text/javascript" src="js/protoedit.js"></script>
<script language="JavaScript" type="text/javascript" src="js/wikiedit2.js"></script>

</head>

<body onload="all_init();" leftmargin="0" topmargin="0" rightmargin="0" bottommargin="0">

<table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td>

<form action="http://78.46.73.113/wiki/wakka.php?wakka=Login"  method="post" >
<input type="hidden" name="wakka" value="Login" />
<input type="hidden" name="action" value="login" />
<div class="header">
  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
  	<tr>
  		<td align="left" class="logo_header">
  		
  		</td>
  		<td align="right" valign="top" class="logo_header"> 
								<span>
					<a href="wakka6b42.html?wakka=Login">
						<b>Вход</b>
					</a>
				</span>
				<!-- <span class="nobr"><input type="hidden" name="goback" value="PrimeryRabotySipStudioAmbs/AkkauntingCisco2AMBS" 
				/><strong>Вход:&nbsp;</strong><input 
				type="text" name="name" size="18" class="login" />&nbsp;Пароль:&nbsp;<input type="password" name="password"  
				class="login" size="8" />&nbsp;<input type="image" 
				src="http://78.46.73.113/wiki/themes/default/icons/login.gif" alt=">>>" align="top" /></span>-->
							</td>
		</tr>
		<tr>
			<td colspan="2" class="bookmarks">
							</td>
		</tr>
		<tr>
			<td colspan="2" class="logo_header">
				<b>
				<!--     <span class="main">IpstudioWiki:</span> -->
				     <span class="main"><a href="wakkad0e2.html?wakka=KnowledgeBase">Knowledge&nbsp;Base</a></span>
								     <span class="main">:: <a  href="wakka2c0b.html?wakka=PrimeryRabotySipStudioAmbs&amp;v=1c1f" class="" title="Примеры&nbsp;Работы&nbsp;Сip&nbsp;Studio&nbsp;Ambs">ПримерыРаботыСipStudioAmbs</a>/АккаунтингCisco2AMBS</span>     
								</b>
				<!--     <span class="main"><a class="Search" title="" 
				     href="http://78.46.73.113/wiki/wakka.php?wakka=TextSearch&amp;phrase=%CF%F0%E8%EC%E5%F0%FB%D0%E0%E1%EE%F2%FB%D1ipStudioAmbs%2F%C0%EA%EA%E0%F3%ED%F2%E8%ED%E3Cisco2AMBS">...</a></span> -->
				</td>
			</tr>
		</table>
</form>

<div class="pageBefore">
	<img src="images/z.gif" width="1" height="1" border="0" alt="" style="display:block" align="top" />
</div><div class="page">
<a name="p14057-1"></a><p class="auto" id="p14057-1"><strong> <a name=".." href="wakka2c0b.html?wakka=PrimeryRabotySipStudioAmbs&amp;v=1c1f" class="" title="ПримерыРаботыСipStudioAmbs/..">В оглавление</a> </strong><br />
<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo--></p><a name="h223-1"></a><h2>Получение аккаунтинговой информации с&nbsp;оборудования Cisco</h2><a name="p14057-2"></a><p class="auto" id="p14057-2">
<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo--><br />
<strong>1.</strong> Нужно создать радиуса процесс для&nbsp;циски(ок).</p><div class="indent">cd /usr/local/billing/bin<br />
ls&nbsp;radiusd</div>
<br /><a name="p14057-3"></a><p class="auto" id="p14057-3">
Должен присутствовать файл:</p><div class="indent">radiusd</div>
<br /><a name="p14057-4"></a><p class="auto" id="p14057-4">
Делаем его&nbsp;копию, чтобы получить независимый скрипт для&nbsp;обработки пакетов с&nbsp;циски:</p><div class="indent">cp radiusd rad_cisco</div>
<br /><a name="p14057-5"></a><p class="auto" id="p14057-5">
<strong>2.</strong> Теперь нужно создать файл конфигурации радиуса для&nbsp;цисок:</p><div class="indent">cd /usr/local/billing/radius</div>
<br /><a name="p14057-6"></a><p class="auto" id="p14057-6">
в&nbsp;этой папке нужно создать файл “cisco.cfg”, пример:</p><div class="indent">vi cisco.cfg</div>
<br /><a name="p14057-7"></a><p class="auto" id="p14057-7">
файл должен иметь аналогичную структуру с&nbsp;любым другим файлом конфигурации радиуса, пример:<br />
<!--notypo--><textarea class="code" rows="15" readonly="readonly"># System directories path:
LogDir         /usr/local/billing/radius/
DbDir           /usr/local/billing/radius/

# User a lower trace level in production systems:
Trace          2
AuthPort 1942
AcctPort 1943

# You will probably want to change this to suit your site.
&lt;Client DEFAULT&gt;
  Secret  voipcard
  DupInterval 0
&lt;/Client&gt;


&lt;Realm DEFAULT&gt;
    &lt;AuthBy Cisco&gt;
    DBSource        dbi:mysql:voip
    DBUsername      voip
    DBAuth          djbg123
    CP_LOG_FILE     %Lciscolog%y%m%d.%H
    ACC_LOG_FILE    %Lcdr%y%m%d.%H
    LOCK_FILE       %Lradius.lock
    CREDIT_TIME     1800
    FREE_TIME       60
    MAX_SEANS       16
    CREDIT_SEANS    16
  &lt;/AuthBy&gt;
&lt;/Realm&gt;</textarea><!--/notypo--></p><br /><a name="p14057-8"></a><p class="auto" id="p14057-8">
Можно скопировать и&nbsp;вставить весь выше представленный текс в&nbsp;файл конигурации для&nbsp;диалапа. <br />
Обязательно нужно проверить следующие параметры и&nbsp;убедиться, что&nbsp;они соответствуют вашим реальным данным:</p><br /><a name="p14057-9"></a><p class="auto" id="p14057-9">
<strong><!--notypo-->LogDir<!--/notypo--></strong> – Папка куда циско-радиус будет писать свои логи, по&nbsp;умолчанию «/usr/local/billing/radius/»<br />
Файлы с&nbsp;логами будут иметь следующий формат имени – ciscologГГММДД.ЧЧ, пример – ciscolog060614.15.</p><br /><a name="p14057-10"></a><p class="auto" id="p14057-10">
<strong>Trace</strong> – Уровень логирования [0–4]. Значение по&nbsp;умолчанию – 2.<br />
Рекомендуется увеличивать значение только при&nbsp;разборе проблем с&nbsp;работой модуля.</p><br /><a name="p14057-11"></a><p class="auto" id="p14057-11">
<strong><!--notypo-->AuthPort, AcctPort<!--/notypo--></strong> – Порты аккаунтинга и&nbsp;авторизации на&nbsp;которых будет работать циско-радиуса. Значения по&nbsp;умолчанию 1942, 1943. Нам&nbsp;интересен аккаунтинг в&nbsp;первую очередь.</p><br /><a name="p14057-12"></a><p class="auto" id="p14057-12">
<strong><!--notypo-->DBUsername, DBAuth<!--/notypo--></strong> – Логин и&nbsp;пароль для&nbsp;подключения к&nbsp;<!--notypo-->MySql<!--/notypo-->-базе системы IP&nbsp;Studio AMBS. Должны совпадать с&nbsp;аналогичными значениями прописанными в&nbsp;файле конфигурации самой системы «/usr/local/billing/etc/bill_util.cfg».</p><br /><a name="p14057-13"></a><p class="auto" id="p14057-13">
<strong>3.</strong> Создать скрипт запуска циско-радиуса.</p><div class="indent">cd /etc/init.d</div>
<br /><a name="p14057-14"></a><p class="auto" id="p14057-14">
в&nbsp;этой папке нужно создать файл “cisco.sh”, пример:</p><div class="indent">vi cisco.sh</div>
<br /><a name="p14057-15"></a><p class="auto" id="p14057-15">
файл должен иметь аналогичную структуру с&nbsp;любым другим файлом запуска радиус-процесса, пример:<br />
<!--notypo--><textarea class="code" rows="15" readonly="readonly">#!/bin/sh 
CONFIG_CISCO=/usr/local/billing/radius/cisco.cfg
RADIUS=/usr/local/billing/bin/rad_cisco
. /usr/local/billing/etc/bill_util.cfg
PIDFILE_CISCO=/usr/local/billing/radius/rad_cisco.pid
case $1 in
  start)
     echo
     if [ -f $PIDFILE_CISCO ; then
      rad_pid=`cat $PIDFILE_CISCO`
   kill -9 $rad_pid
   rm -f $PIDFILE_CISCO
fi
  echo -n Starting CISCO radiusd: 
  nice -n -3 sudo -u $OWNER $RADIUS -config_file $CONFIG_CISCO -pid_file $PIDFILE_CISCO  &gt;&gt; /usr/local/billing/logs/rad_cisco.err 2&gt;&amp;1
  touch $PIDFILE_CISCO
  echo
;;
stop)
  echo
  rad_pid=`cat $PIDFILE_CISCO`
  echo -n Shutting down CISCO radiusd: $rad_pid
  kill -9 $rad_pid
  rm -f $PIDFILE_CISCO
  echo
;;
restart)
  $0 stop
  $0 start
;;
*)
echo &quot;Usage: radiusd {start|stop|restart}&quot;
exit 1
esac</textarea><!--/notypo--></p><br /><a name="p14057-16"></a><p class="auto" id="p14057-16">
После того как&nbsp;скрипт будет создан, его&nbsp;нужно сделать исполняемым: </p><div class="indent">chmod 755 /etc/init.d/cisco.sh</div>
<br /><a name="p14057-17"></a><p class="auto" id="p14057-17">
<strong>4.</strong> Добавить команду на&nbsp;автозапуск циско-радиуса при&nbsp;запуске сервера. Для&nbsp;этого откройте папку “rc3.d”<br />
и&nbsp;проверьте наличие ссылки "@S98cisco.sh":</p><div class="indent">cd /etc/rc3.d<br />
ls&nbsp;-la</div>
<br /><a name="p14057-18"></a><p class="auto" id="p14057-18">
если такой ссылки нет, ее&nbsp;нужно создать, выполнив в&nbsp;этой папке следующую команду:</p><div class="indent">ln -s /etc/init.d/cisco.sh /etc/rc3.d/S98cisco.sh</div>
<br /><a name="p14057-19"></a><p class="auto" id="p14057-19">
Результат должен быть следующего вида, пример:</p><div class="indent">lrwxrwxrwx 1 root root 22 May&nbsp;16 14:03 S98billing.sh -&gt; /etc/init.d/billing.sh<br />
lrwxrwxrwx 1 root root 19 Jun&nbsp;14 15:45 S98cisco.sh -&gt; /etc/init.d/cisco.sh</div>
<br /><a name="p14057-20"></a><p class="auto" id="p14057-20">
<strong>5.</strong> Запустить циско-радиус:</p><div class="indent">/etc/init.d/cisco.sh start</div>
<br /><a name="p14057-21"></a><p class="auto" id="p14057-21">
Примечание: Для&nbsp;ручного запуска и&nbsp;остановки нужно использовать команды “start” и&nbsp;“stop” соответственно.</p><br /><a name="p14057-22"></a><p class="auto" id="p14057-22">
<strong>6.</strong> Проверить, как&nbsp;запустился циско-радиус, командой:</p><div class="indent">ps ax&nbsp;| grep rad&nbsp;</div>
<br /><a name="p14057-23"></a><p class="auto" id="p14057-23">
Если у&nbsp;вас запущена система IP&nbsp;Studio AMBS, используется карточная платформа и&nbsp;вы запустили циско-радиус, <br />
вы&nbsp;увидите примерно следующую картину:</p><div class="indent">17350?  S&nbsp;3:00 /usr/local/billing/bin/radiusd -config_file /usr/local/billing/radius/auth.cfg -pid_file /usr/local/billing/radius/rad_auth.pid<br />
17361?  S&nbsp;3:06 /usr/local/billing/bin/radiusd -config_file /usr/local/billing/radius/acct.cfg -pid_file /usr/local/billing/radius/rad_acct.pid<br />
17371?  S&nbsp;2:05 /usr/local/billing/bin/rad_card -config_file /usr/local/billing/radius/card.cfg -pid_file /usr/local/billing/radius/rad_card.pid<br />
17381?  S&nbsp;2:15 /usr/local/billing/bin/rad_cisco -config_file /usr/local/billing/radius/cisco.cfg -pid_file /usr/local/billing/radius/rad_cisco.pid<br />
4491 pts/1 S&nbsp;0:00 grep rad</div>
<br /><a name="p14057-24"></a><p class="auto" id="p14057-24">
Два&nbsp;процесса самой системы (auth.cfg, acct.cfg), один карточного модуля (card.cfg) и&nbsp;один циско-модуля (cisco.cfg).</p><br /><a name="p14057-25"></a><p class="auto" id="p14057-25">
<strong>7.</strong> Далее нужно настроить циску таким образом, чтобы она&nbsp;отправляла свою аккунтинговую информацию на&nbsp;порты циско-радиуса системы амбс.</p><br /><a name="p14057-26"></a><p class="auto" id="p14057-26">
<strong>8.</strong> После этого можно переходить к&nbsp;настройке самой системы. <br />
 &ndash; В&nbsp;форме MVTS Servers завести циску как&nbsp;еще один MVTS-сервер, <br />
 &ndash; Посмотреть в&nbsp;детальной статистике звонки получаемые радиусом с&nbsp;циски <br />
 &ndash; В&nbsp;соответствии с&nbsp;информацией по&nbsp;шлюзом из&nbsp;детальной статистике завести операторов их&nbsp;шлюзы и&nbsp;тарифы<br />
 &ndash; По&nbsp;завершении заполнения данных операторов, перетарифицировать прошедший период и&nbsp;проверить результат.<br />
<!--notypo--><!--/notypo--><br />
<!--notypo--><!--/notypo--><br />
<strong> <a  href="wakka2c0b.html?wakka=PrimeryRabotySipStudioAmbs&amp;v=1c1f" class="" title="ПримерыРаботыСipStudioAmbs/..">В оглавление</a> </strong></p>   <script language="JavaScript" type="text/javascript">
   var dbclick = "page";
  </script>
 <br style="clear:both" />&nbsp;
</div>

<form action="http://78.46.73.113/wiki/wakka.php?wakka=TextSearch"  method="get" >
<input type="hidden" name="wakka" value="TextSearch" />
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="footer">
	<tr>
		<td>
			 
			
			  <span class="searchbar nobr">Поиск: <input type="text" name="phrase" size="25" style="border: none; border-bottom: 1px solid #CCCCAA; padding: 0px; margin: 0px;" /></span>
		</td>
		<td align="right">
			<a href="wakka85f1.html?wakka=PrimeryRabotySipStudioAmbs/AkkauntingCisco2AMBS/print" target="_new"><img src="themes/default/icons/1print.gif" title="Версия для печати" alt="Версия для печати"  align="middle" border="0" /></a>		</td>
	</tr>
</table>

</form>


<table class="copyright" width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
	<tr>
		<td align="left" class="copyright">
			Created by <a target="_blank" class="copyright" href="http://www.ipstudio.net/">IP Studio Inc.</a>© 2007
		</td>
		<td align="right" class="copyright">
			Powered by <a href="http://wackowiki.com/WackoWiki" target="_blank" title="" class="outerlink">WackoWiki R4.2</a>		</td>
	</tr>
</table>

</td>
</tr>
</table>
</body>
<!-- Mirrored from 78.46.73.113/wiki/wakka.php?wakka=PrimeryRabotySipStudioAmbs/AkkauntingCisco2AMBS&v=17l4 by HTTrack Website Copier/3.x [XR&CO'2006], Wed, 25 Jul 2012 16:10:18 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=windows-1251"><!-- /Added by HTTrack -->
</html>